---
title: "Problems with the igcop C functions"
output: html_document
---

```{r}
library(devtools)
load_all()
y_igl_gen(2, 2)
```

## 1\. Inverses

Tests on the 2|1 IG and IGL quantile functions fail. Digging further, the problem lies with three out of the four Newton Raphson algorithms (although oddly enough, when coded up in R, these algorithms worked just fine).

1. Inverse of $H_{\psi}$ (biggest problem)

```{r}
y_interp_gen(y_interp_gen_inv(0.999985, 2.5, 0.1), 2.5, 0.1) 
```

(Should = `0.999985`)

Here is a plot of $H_{\psi}$ near 0 -- its slope approaches $-\infty$ at 0. Finding the root on a log-x scale still does not solve the problem.  

```{r, fig.width = 3, fig.height = 3}
H1 <- function(x) y_interp_gen(x, 2.5, 0.1)
curve(H1, 0, 0.1, n = 1001)
```


2. Inverse of $H_{\kappa}$.

```{r}
y_interp_kappa(y_interp_kappa_inv(0.99999, 1.75, 0.1), 1.75, 0.1) 
```

(Should = `0.99999` -- not bad!)

Here is a plot of $H_{\kappa}$ near 0 -- its slope also approaches $-\infty$ at 0. Finding the root on a log-x scale still does not solve the problem.  

```{r, fig.width = 3, fig.height = 3}
H2 <- function(x) y_interp_kappa(x, 1.75, 0.1)
curve(H2, 0, 0.1, n = 1001)
```

3. Inverse of $\psi$:

```{r}
y_igl_gen(y_igl_gen_inv(0.99999, 0.1), 0.1)
```

(Should = `0.99999` -- not bad!)

Here's a plot of $\psi$ near 0. Again, steep slope. 

```{r, fig.width = 3, fig.height = 3}
psi <- function(x) y_igl_gen(x, 0.1)
curve(psi, 0, 0.1, n = 1001)
```

There doesn't appear to be a problem with the `qcondig12` algorithm:

```{r}
pcondig12(qcondig12(1e-05, 0.3, 2.5, 0.1), 0.3, 2.5, 0.1) 
```

## 2\. `qgamma` function

Our in-house `qgamma` function does not always align with modern R's version:

```{r}
y_qgamma(0.001, shape = 0.1)  # In-house
qgamma(0.001, shape = 0.1)    # R's version
```

## 3\. `dgamma` function at 0

Our in-house `dgamma` function does not evaluate the limit at 0 when $\alpha = 1$:

```{r}
y_dgamma(0, shape = 1)
dgamma(0, shape = 1)
```

As a result, the derivative $\psi'$ cannot be evaluated at 0:

```{r}
y_igl_gen_D(0, alpha = 1)
```

